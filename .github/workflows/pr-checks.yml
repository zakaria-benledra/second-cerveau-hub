name: PR Checks

on:
  pull_request:
    types: [opened, synchronize, reopened]

jobs:
  pr-validation:
    name: PR Validation
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0
      
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'
      
      - name: Install dependencies
        run: npm ci
      
      - name: Check for console.log statements
        run: |
          # Find console.log in src files (excluding tests)
          CONSOLE_LOGS=$(grep -r "console\.log" src --include="*.ts" --include="*.tsx" \
            --exclude-dir="test" --exclude-dir="__tests__" | wc -l || true)
          
          if [ "$CONSOLE_LOGS" -gt 10 ]; then
            echo "‚ö†Ô∏è Found $CONSOLE_LOGS console.log statements. Consider using structured logging."
          fi
      
      - name: Check bundle size
        run: |
          npm run build
          
          # Get bundle size
          BUNDLE_SIZE=$(du -sh dist | cut -f1)
          echo "üì¶ Bundle size: $BUNDLE_SIZE"
          
          # Check if stats.html exists (from visualizer)
          if [ -f "dist/stats.html" ]; then
            echo "üìä Bundle analysis available in artifacts"
          fi
      
      - name: Upload build for review
        uses: actions/upload-artifact@v4
        with:
          name: pr-build-${{ github.event.pull_request.number }}
          path: dist/
          retention-days: 3
